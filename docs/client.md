# Работа с API клиента

## Регистрация пользователя
Регистрация пользователя происходит через отправку **POST** запроса на API **/api/v1/reg/**.

Обязательные параметры:
- **first_name** - имя пользователя (string)
- **middle_name** - отчество (string)
- **last_name** - фамилия (string)
- **email** - имейл (string)
- **password** - пароль (string)
- **password_repeat** - повторный ввод пароля (string)
- **company** - компания (string)
- **position** должность (string)

Пример запроса:
```json
{
    "first_name": "Maksim",
    "middle_name": "Andreevich",
    "last_name": "Ksenofontov",
    "email": "client@gmail.com",
    "password": "password",
    "password_repeat": "password",
    "company": "Freelancer",
    "position": "json Developer"
}
```

Пример успешного ответа:
```json
{
    "first_name": "Maksim",
    "middle_name": "Andreevich",
    "last_name": "Ksenofontov",
    "email": "client@mail.ru",
    "company": "Freelancer",
    "position": "json Developer"
}
```

После регистрации пользователя на указанный имейл приходит письмо с токеном для его подтверждения.

## Подтверждение имейла пользователя
Для подтверждения имейла необходимо отправить **POST** запрос с полученным токеном на API **/api/v1/confirm/**.

Пример запроса:
```json
{
    "token": "a5cb2f336392b5d286d51babc8011b189824c09c"
}
```

Пример успешного ответа:
```json
{
    "token": null
}
```

При прохождении процедуры указанный токен обнуляется; пользователь получает возможность авторизации и работы с пользовательскими API.

## Смена пароля
Для изменения пароля пользователя отправьте **PATCH** запрос на API **/api/v1/pwd/4/** с указанием идентификатора пользователя, а так же заголовка, содержащего токен пользователя.

Обязательные параметры: **password** - новый пароль (string).

Пример заголовка:
```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример тела запроса:
```json
{
    "password": "!P@$$W0RD!"
}
```

Пример успешного ответа:
```json
{}
```

## Авторизация
Авторизация подразумевает получение токена. Для получения токена отправьте отправьте **POST** запрос на API **/api/v1/auth/**.

Обязательные параметры: **username** - имейл пользователя (string), **password** - пароль (string).

Пример тела запроса:
```json
{
    "username": "client@gmail.com",
    "password": "password"
}
```

Пример успешного ответа:
```json
{
    "token": "fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188"
}
```

## Получение списка существующих продуктов
Для получения списка продуктов со всех магазинов отправьте **GET** запрос на API **/api/v1/products/**.

Пример успешного ответа:
```json
[
    {
        "id": 5,
        "name": "Бананы"
    },
    {
        "id": 7,
        "name": "Капуста"
    },
]
```

Для получения детальной информации по конкретному продукту отправьте **GET** запрос на тот же API с указанием его идентификатора. Например: **/api/v1/products/5/**.

Пример успешного ответа:
```json
{
    "id": 5,
    "name": "Бананы",
    "available_in": [
        {
            "position_id": 5,
            "shop_id": 2,
            "shop": "Перекресток",
            "category_id": 4,
            "category": "Фрукты",
            "in_stock": 1000000,
            "price": 75
        }
    ]
}
```

Результатом является детальная информация о продукте, содержащая поле position_id, **по которому и необходимо добавлять товары в корзину**.

Помимо этого API так же предоставляет возможность фильтрации по категории и магазину. Для этого необходимо добавить опциональные параметры **shop** и/или **category** в **GET** запрос. Например: **/api/v1/products/?shop=1&category=1**.

Пример успешного ответа:
```json
[
    {
        "id": 4,
        "name": "Смартфон Apple iPhone XR 128GB (синий)"
    },
    {
        "id": 2,
        "name": "Смартфон Apple iPhone XR 256GB (красный)"
    }
]
```

## Получение состояния корзины
Для отображения текущих товаров в корзине отправьте **GET** запрос на API **/api/v1/basket/** с указанием заголовка, содержащего токен пользователя.

Пример заголовка:
```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример успешного ответа:
```json
[
    {
        "id": 1,
        "total": 558000,
        "positions": [
            {
                "id": 1,
                "name": "Смартфон Apple iPhone XS Max 512GB (золотистый)",
                "price": 110000,
                "quantity": 5,
                "status": "new"
            },
        ]
    }
]
```

## Добавление товаров в корзину
Для добавления товаров в корзину отправьте **PUT** запрос на API **/api/v1/basket/1/** с указанием идентификатора корзины, а так же заголовка, содержащего токен пользователя.

Обязательные параметры:
- **id** - идентификатор позиции товара (string)
- **quantity** - количество добавляемых позиций (integer)

Пример заголовка:
```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример тела запроса:
```json
{
    "positions": [
        {
            "id": 1,
            "quantity": 5
        },
        {
           "id": 5,
           "quantity": 100
        },
    ]
}
```

Пример успешного ответа:
```json
{
    "id": 1,
    "total": 558000,
    "positions": [
        {
            "id": 1,
            "name": "Смартфон Apple iPhone XS Max 512GB (золотистый)",
            "price": 110000,
            "quantity": 5,
            "status": "new"
        },
        {
            "id": 5,
            "name": "Бананы",
            "price": 75,
            "quantity": 100,
            "status": "new"
        },
    ]
}
```

## Очистка корзины
Для очистки корзины отправьте **PATCH** запрос на API **/api/v1/basket/1/** с указанием идентификатора корзины, а так же заголовка, содержащего токен пользователя.

Пример заголовка:
```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример успешного ответа:
```json
{
    "id": 1,
    "total": null,
    "positions": []
}
```

## Получение списка заказов
Для получения списка имеющихся заказов отправьте **GET** запрос на API **/api/v1/orders/** с указанием заголовка, содержащего токен пользователя.

Пример заголовка:
```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример успешного ответа:
```json
[
    {
        "id": 9,
        "total": 558000,
        "status": "new",
        "positions": [
            {
                "id": 1,
                "name": "Смартфон Apple iPhone XS Max 512GB (золотистый)",
                "price": 110000,
                "quantity": 5,
                "status": "new"
            },
            {
                "id": 5,
                "name": "Бананы",
                "price": 75,
                "quantity": 100,
                "status": "new"
            },
        ]
    }
]
```

## Создание заказа
Для создания заказа на основе товаров из корзины отправьте **POST** запрос на API **/api/v1/orders/** с указанием заголовка, содержащего токен пользователя..

Обязательные параметры: **delivery_address** - адрес доставки товаров (string).

```
Authorization
Token fc1351ddd4a1bb4e235f063aa0e0a0236e0cb188
```

Пример тела запроса:
```json
{
    "delivery_address": "Saint Petersburg, Afonskaya 20-121"
}
```

Пример успешного ответа:
```json
{
    "id": 13,
    "total": 558000,
    "status": "new",
    "positions": [
        {
            "id": 1,
            "name": "Смартфон Apple iPhone XS Max 512GB (золотистый)",
            "price": 110000,
            "quantity": 5,
            "status": "new"
        },
        {
            "id": 5,
            "name": "Бананы",
            "price": 75,
            "quantity": 100,
            "status": "new"
        },
    ]
}

После создания заказа на имейл пользователя и поставщиков отправляются письма-оповещения.
